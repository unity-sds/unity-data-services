from unittest import TestCase

from cumulus_lambda_functions.lib.aws.aws_message_transformers import AwsMessageTransformers


class TestAwsMessageTransformers(TestCase):
    def test_01(self):
        event = {'Records': [{'EventSource': 'aws:sns', 'EventVersion': '1.0', 'EventSubscriptionArn': 'arn:aws:sns:us-west-2:429178552491:uds-sbx-cumulus-mock_daac_cnm_sns:35fc364f-2c1a-4139-af3f-bbc2921ea50b', 'Sns': {'Type': 'Notification', 'MessageId': '0ea4a024-e0d6-5c2c-a250-ff06f4c21805', 'TopicArn': 'arn:aws:sns:us-west-2:429178552491:uds-sbx-cumulus-mock_daac_cnm_sns', 'Subject': None, 'Message': '{"collection": "DAAC:MOCK:UDS_UNIT_COLLECTION", "identifier": "URN:NASA:UNITY:UDS_LOCAL_TEST:DEV:UDS_UNIT_COLLECTION___2407291400:abcd.1234.efgh.test_file05", "submissionTime": "2024-07-29T22:04:03.918874Z", "provider": "UDS_LOCAL_TEST", "version": "1.6.0", "product": {"name": "UDS_UNIT_COLLECTION___2407291400", "dataVersion": "9098", "files": [{"type": "data", "name": "abcd.1234.efgh.test_file05.data.stac.json", "uri": "https://uds-distribution-placeholder/uds-sbx-cumulus-staging/URN:NASA:UNITY:UDS_LOCAL_TEST:DEV:UDS_UNIT_COLLECTION___2407291400/URN:NASA:UNITY:UDS_LOCAL_TEST:DEV:UDS_UNIT_COLLECTION___2407291400:abcd.1234.efgh.test_file05/abcd.1234.efgh.test_file05.data.stac.json", "checksumType": "md5", "checksum": "unknown", "size": -1}, {"type": "metadata", "name": "abcd.1234.efgh.test_file05.cmr.xml", "uri": "https://uds-distribution-placeholder/uds-sbx-cumulus-staging/URN:NASA:UNITY:UDS_LOCAL_TEST:DEV:UDS_UNIT_COLLECTION___2407291400/URN:NASA:UNITY:UDS_LOCAL_TEST:DEV:UDS_UNIT_COLLECTION___2407291400:abcd.1234.efgh.test_file05/abcd.1234.efgh.test_file05.cmr.xml", "checksumType": "md5", "checksum": "da19420ead0e92f6855da49269e06017", "size": 1788}]}}', 'Timestamp': '2024-07-29T22:04:04.098Z', 'SignatureVersion': '1', 'Signature': 'qLCKInsVIif1kGSM5128Nio6p+eWLZG8Cpl/f7thLhqN0RjiKSRIpk60fmTuHJBVs33Fu34WqukGiI4ywxFkpPUdUG1NBTjS/0pLjkLotD78tNs2C0JCjqbSoqrvR2ftB7AQhq+Dpwg7Lx60wirDDK7ocUH3ZP3uQMef9Kj2vGdyvBA3Cd2PecwkGHpnjs4LBZgLBcIGrjMCaHJBw1D9kRUAC2F+EgphmP327HAM6zuemHsNjWaS7gYeR9sDlOnhpSgW3Nx7CBMRA9C0v4BS/my50luqq1TXkhfvvtNI9q6yXV58175a6Zx2xyFiSG67QeKeubJo+YCNrwS+dJz2Cw==', 'SigningCertUrl': 'https://sns.us-west-2.amazonaws.com/SimpleNotificationService-60eadc530605d63b8e62a523676ef735.pem', 'UnsubscribeUrl': 'https://sns.us-west-2.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:us-west-2:429178552491:uds-sbx-cumulus-mock_daac_cnm_sns:35fc364f-2c1a-4139-af3f-bbc2921ea50b', 'MessageAttributes': {}}}]}
        input_event = AwsMessageTransformers().get_message_from_sns_event(event)
        self.assertTrue('collection' in input_event, f'missing collection')
        self.assertTrue('identifier' in input_event, f'missing identifier')
        return
